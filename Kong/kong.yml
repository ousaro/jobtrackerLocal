_format_version: "1.1"
plugins: # this for global plugins 
  - name: cors
    config:
      origins:
        - http://localhost:3000
      methods:
        - GET
        - POST
        - PUT
        - DELETE
        - OPTIONS
      headers:
        - Accept
        - Authorization
        - Content-Type
      credentials: true

services:
  - name: auth-service
    url: http://host.docker.internal:5000  # http://auth_service.service.consul:5000
    routes:
      - name: auth-service-route
        paths:
          - /api/auth_service
  
  - name: user_service
    url: http://host.docker.internal:5001  # http://user_service.service.consul:5001
    routes:
      - name: user_service-route
        paths:
          - /api/user_service
    plugins:
      - name: jwt
    
  - name: application_service
    url: http://host.docker.internal:5002  # http://application_service.service.consul:5002
    routes:
      - name: application_service-route
        paths:
          - /api/application_service
    plugins:
      - name: jwt

  - name: interview_service
    url: http://host.docker.internal:5003  # http://interview_service.service.consul:5003
    routes:
      - name: interview_service-route
        paths:
          - /api/interview_service
    plugins:
      - name: jwt

  - name: contact_service
    url: http://host.docker.internal:5004  # http://contact_service.service.consul:5004
    routes:
      - name: contact_service-route
        paths:
          - /api/contact_service
    plugins:
      - name: jwt
    
  - name: analytics_service
    url: http://host.docker.internal:5005  # http://analytics_service.service.consul:5005
    routes:
      - name: analytics_service-route
        paths:
          - /api/analytics_service
    plugins:
      - name: jwt
  
  - name: dashboard_service
    url: http://host.docker.internal:5006  # http://dashboard_service.service.consul:5006
    routes:
      - name: dashboard_service-route
        paths:
          - /api/dashboard_service
    plugins:
      - name: jwt

  - name: fileUpload_service
    url: http://host.docker.internal:5007  # http://fileupload_service.service.consul:5007
    routes:
      - name: fileupload_service-route
        paths:
          - /api/fileupload_service
    plugins:
      - name: jwt
  
  - name: notification_service
    url: http://host.docker.internal:5008  # http://notification_service.service.consul:5008
    routes:
      - name: notification_service-route
        paths:
          - /api/notification_service
    plugins:
      - name: jwt
  
  - name: search_service
    url: http://host.docker.internal:5009  # http://search_service.service.consul:5009
    routes:
      - name: search_service-route
        paths:
          - /api/search_service
    plugins:
      - name: jwt

# this used when using Consul for service discovery or for load balancing
# upstreams:
#   - name: localhost # application_service.service.consul
#     healthchecks:
#       active:
#         http_path: /health
#         timeout: 1
#         healthy:
#           http_statuses: [200]
#         unhealthy:
#           http_statuses: [500]

#   this is for consumers to be able to use JWT authentication    
consumers:
  - username: jobTracker         # app name
    custom_id: jobTracker     # app id for tracking
    jwt_secrets:
      - key: JobTracker
        secret: mysecret
        algorithm: RS256
        rsa_public_key: |
          -----BEGIN PUBLIC KEY-----
          MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAynEZ0WQuWqUSr7wwKn5e
          qflvw9fBjhq3FhQIvIyA/Qr+Slk5doBJvqlpnAR4YGoSrDNf8pvJECBRT2KlgWWt
          cOlWaOdIEmaiUdGdlxVrVdx1ZcLjLVLThWg+UG8l2L/Z9D3mC8VXECWzSNE1ugfw
          RDD6sIB5TaY4r0Ve9OCfcLD+OCeNZjgsYUFRu8IAoDzZnBeb1dqdneIRTnq7Xvls
          fvzdOjWCOqiKuH6M1PkqcfeJZeyRZdnX30UJEUjM10ZkW+k97dLC1/3xVnwMJjr1
          igN7lNvPgxCeRs8jRF4VZfWOZnQ2OJFdzN3qeWdtQn4sJZDOBMainQsSNFck2Nu1
          bwIDAQAB
          -----END PUBLIC KEY-----
